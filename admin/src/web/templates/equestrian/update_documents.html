{% extends "layout.html" %}

{% from "macros/file_icon.html" import render_file_icon %}
{% from "macros/delete_modal.html" import render_delete_modal %}
{% from "equestrian/macros/parse_categories.html" import render_category %}
{% from "macros/flash_message.html" import render_flash_messages %}

{% block title %} Caballos - Actualizar documentos {% endblock %}

{% block main_content %}
<nav class="breadcrumb" aria-label="breadcrumbs">
  <ul>
    <li>
      <a href="{{ url_for('index_bp.home')}}">
        <span class="icon is-small">
          <i class="fas fa-home" aria-hidden="true"></i>
        </span>
        <span>Inicio</span>
      </a>
    </li>
    <li>
      <a href="{{ url_for('equestrian_bp.get_horses') }}">
        <span class="icon is-small">
          <i class="fas fa-horse" aria-hidden="true"></i>
        </span>
        <span>Caballos</span>
      </a>
    </li>
    <li>
      <a href="{{ url_for('equestrian_bp.show_horse', horse_id=horse.id) }}">
        <span class="icon is-small">
          <i class="fas fa-horse-head" aria-hidden="true"></i>
        </span>
        <span>{{ horse.name }}</span>
      </a>
    </li>
    <li>
      <a href="">
        <span class="icon is-small">
          <i class="fa-solid fa-pen-nib"></i>
        </span>
        <span>Actualizar documentos</span>
      </a>
    </li>
  </ul>
</nav>
<div class="container">
  <h4 class="title is-fullwidth has-text-centered">Actualizando documentos de {{ horse.name }}</h4>
  <div class="tabs is-toggle is-fullwidth is-toggle-rounded is-centered is-medium">
    <ul>
      <li class="">
        <a href="{{ url_for("equestrian_bp.edit_horse", horse_id=horse.id ) }}">
          <span class="icon is-small">
              <i class="fa fa-info-circle" aria-hidden="true"></i>
          </span>
          <span>Información General</span>
        </a>
      </li>
      <li class="is-active">
        <a>
          <span class="icon is-small">
              <i class="far fa-file-alt" aria-hidden="true"></i>
          </span>
          <span>Documentos Anexos</span>
        </a>
      </li>
    </ul>
  </div>
</div>

<section class="section pt-4 px-0">
  {{ render_flash_messages(messages) }}
  <div id="documents" class="card">
    <header class="card-header">
      <h2 class="card-header-title is-size-4 m-0">Documentación relacionada</h2>
    </header>
    <div class="card-content">
      <form method="POST" class="block" enctype="multipart/form-data">
        {{ add_form.hidden_tag() }}
        <div class="is-flex is-gap-2">
          <div class="field">
            <div class="control">
              <div class="select">
                {{ add_form.tag(class="is-fullwidth")}}
              </div>
            </div>
            {% if add_form.tag.errors %}
            <p class="help is-danger">{{ add_form.tag.errors[0] }}</p>
            {% endif %}
          </div>
          <div class="field">
            <div class="file has-name">
              <label class="file-label">
                {{ add_form.file(class="file-input", multiple="multiple") }}
                <span class="file-cta">
                  <span class="file-icon">
                    <i class="fas fa-upload"></i>
                  </span>
                  <span class="file-label"> Elegir archivo </span>
                </span>
                <span class="file-name">No se ha seleccionado ningún archivo</span>
              </label>
            </div>
            {% if add_form.file.errors %}
                <p class="help is-danger">{{ add_form.file.errors[0] }}</p>
            {% endif %}
          </div>
        </div>
        <div class="field">
          <div class="control">
            <button type="submit" class="button is-fullwidth is-primary" aria-haspopup="true" aria-controls="Add document">
              Agregar documento
              <span class="icon ml-1">
                <i class="fa-solid fa-file is-size-5" aria-hidden="true"></i>
              </span>
            </button>
          </div>
        </div>
      </form>
      <div class="content">
        {% if horse.files %}
        {% for document in documents %}
        <div class="card">
          <article class="card-content level is-flex is-flex-wrap-wrap is-justify-content-space-between">
            <div class="media m-0">
              <div class="media-left">
                {{ render_file_icon(document.file.filetype, size=1) }}
              </div>
              <div class="media-content ml-2">
                <p>
                  <strong class="tag is-white">{{ render_category(document.file.tag) }}</strong>
                  <small class="ml-1">{{ document.file.uploaded_at | format_date }}</small>
                  <br />
                  {{ document.file.title }}
                  </p>
              </div>
            </div>
            <div class="field has-addons">
              <div class="control">
                <button class="button is-danger hover modal-trigger" data-id="{{ document.file.id }}" data-target="user-delete-modal">
                  <span class="icon mr-1">
                    <i class="fa-solid fa-trash"></i>
                  </span>
                  Eliminar
                </button>
              </div>
              <div class="control">
                <a href="{{ document.download_url }}" target="_blank" class="button is-link">
                  <span class="icon mr-1">
                    <i class="fa-solid fa-download"></i>
                  </span>
                  Descargar
                </a>
              </div>
            </div>
          </article>
        </div>
        {% endfor %}
        {% else %}
        <p>No se ha subido ningún documento para este caballo</p>
        {% endif %}
      </div>
    </div>
  </div>
</section>

{% block modal %}
    {{ render_delete_modal(
        url_for("equestrian_bp.delete_document", horse_id=horse.id),
        title="Eliminar documento",
        msg="¿Está seguro de que desea eliminar el documento?",
        msg_sub="Luego de confirmar, no se podrán revertir los cambios"
    ) }}
{% endblock %}
{% endblock %}

{% block extra_scripts %}
    {{ super() }}
    <script src="{{ url_for('static', filename='js/file-input.js') }}"></script>
{% endblock %}
