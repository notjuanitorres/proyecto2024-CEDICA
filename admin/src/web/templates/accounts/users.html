{% extends "layout.html" %} 

{% from "macros/pagination.html" import render_pagination %}
{% from "macros/edit_menu.html" import render_actions_menu %}
{% from "macros/delete_modal.html" import render_delete_modal %}

{% block title %}Usuarios{% endblock %} 

{% block head %} 
    {{ super() }} 
{% endblock %} 

{% block main_content %}
  <nav class="breadcrumb mb-2" aria-label="breadcrumbs">
    <ul>
      <li>
        <a href="{{ url_for('index_bp.home')}}">
          <span class="icon is-small">
            <i class="fas fa-home" aria-hidden="true"></i>
          </span>
          <span>Inicio</span>
        </a>
      </li>
      <li>
        <a href="">
          <span class="icon is-small">
            <i class="fas fa-users" aria-hidden="true"></i>
          </span>
          <span>Usuarios</span>
        </a>
      </li>
    </ul>
  </nav>

  {% with messages = get_flashed_messages(with_categories=true) %}
  {% if messages %}
  {% for category, message in messages %}
  <ul>
      <li class="notification is-{{ category }} mt-4 mx-2">
          <button class="delete"></button>
          {{ message }}
      </li>
  </ul>
  {% endfor %}
  {% endif %}
  {% endwith %}

  <section class="is-fullheight-with-navbar">
    <div class="table-container p-2">
      <div class="box">
        <a class="button" href="{{ url_for('users_bp.create_user')}}">Crear usuario</a>
      </div>
      <table class="table is-striped is-scrollable is-fullwidth ">
        <thead>
          <tr>
            <th></th>
            <th>ID</th>
            <th>Correo</th>
            <th>Alias</th>
            <th>Activo</th>
            <th>Roles</th>
            <th>Admin</th>
            <th>Ingreso</th>
            <th>Actualizado</th>
            <th></th>
          </tr>
        </thead>
        <tbody>
          {% for user in users %}
          <tr>
            <td>
              {{ 
                render_actions_menu(
                value=user.id,
                to_left=true,
                endpoints={
                  'show':'users_bp.show_user', 
                  'edit': 'users_bp.edit_user', 
                  'delete':''
                })
              }}
            </td>
            <td>{{ user.id }}</td>
            <td>{{ user.email }}</td>
            <td>{{ user.alias }}</td>
            <td>{{ user.enabled | natural_boolean }}</td>
            <td>{{ user.roles }}</td>
            <td>{{ user.system_admin | natural_boolean }}</td>
            <td>{{ user.inserted_at | format_date }}</td>
            <td>{{ user.updated_at | format_date }}</td>
            <td>
              {{ 
                render_actions_menu(
                value=user.id,
                to_left=false,
                endpoints={
                  'show':'users_bp.show_user', 
                  'edit':'users_bp.edit_user', 
                  'delete':''
                })
              }}
            </td>       
          </tr>
          {% endfor %}
        </tbody>
        <tfoot>
          <tr>
            <th></th>
            <th>ID</th>
            <th>Email</th>
            <th>Alias</th>
            <th>Activo</th>
            <th>Roles</th>
            <th>Admin</th>
            <th>Ingreso</th>
            <th>Actualizado</th>
            <th></th>
          </tr>
        </tfoot>
      </table>
      <div class="container px-5">{{ render_pagination(users, 'users_bp.get_users') }}</div>

      {{ 
        render_delete_modal(
          endpoint="users_bp.delete_user", 
          title="Eliminar", 
          msg="¿Está seguro de que desea eliminar al usuario?", 
          msg_sub="Luego de confirmar, no se podrán revertir los cambios"
        ) 
      }}
    </div>
  </section>
{% endblock %}

